## ADR-003: Конфигурация и секреты через env

### Context

По **NFR-10** все секреты (JWT-ключи, пароли БД, API-ключи) должны храниться в переменных окружения,
а не в коде и не в коммитах.

Нужно простое решение, которое:
- не ломает текущую структуру проекта;
- не требует сложных библиотек;
- позволяет читать значения из env с понятными дефолтами для разработки.

### Decision

Создаём модуль `app/config.py` с простой моделью настроек:

- `Settings` — dataclass, который читает значения из переменных окружения через `os.getenv`;
- важные поля:
  - `secret_key` — секрет для подписания токенов (пока используется как заготовка);
  - `max_upload_size_bytes` — лимит размера файла для secure upload;
  - `allowed_upload_content_types` — список допустимых MIME-типов для загрузок;
- экспортируем экземпляр `settings = Settings()`, который можно импортировать в других модулях.

Для учебных целей задаём безопасный дефолт (например, dev-ключ), но в ADR явно фиксируем,
что в бою значение должно приходить из окружения.

### Consequences

Плюсы:
- Конфигурация собрана в одном месте, не нужно искать числа и секреты по всему коду;
- Легко переопределить настройки через переменные окружения при развёртывании;
- Можно использовать те же настройки в модуле secure upload и других частях приложения.

Минусы:
- При изменении структуры настроек может понадобиться перезапуск сервиса;
- Dataclass не делает сложной валидации типов (но для учебного проекта это достаточно).

### Security impact

Положительное влияние:
- Уменьшаем риск **R-07**: секретный ключ и другие чувствительные значения не попадают в код и git (по умолчанию читаем из env);
- Проще выполнять **NFR-10** — все новые секреты добавляем как поля в `Settings` и читаем их из окружения;
- Модуль конфигурации можно использовать в других security-фичах (rate limiting, secure upload и т.д.).

Ограничения:
- Если разработчик забудет настроить переменные окружения и оставит dev-значения в проде — это риск, здесь нужна дисциплина;
- Сам по себе модуль не защищает от утечки переменных окружения из окружения/инфраструктуры.

### Links

- **NFR:** NFR-10 (секреты в переменных окружения).
- **STRIDE:** строка `Auth Service` (Tampering секретного ключа JWT).
- **RISKS:** R-07 (секретный ключ в коде и в git).
- **Код:** `app/config.py`, использование в `app/secure_upload.py`.
- **Тесты:** `test_settings_reads_secret_key_from_env`.
